<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,个人博客,blog" />
  <meta name="description" content="LittleY的个人博客" />
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  <link rel="dns-prefetch" href="https://at.alicdn.com">
  
  
  
  <link rel="stylesheet" type="text/css" href="/./style/main.css">
	<link rel="shortcut icon" href="/favicon.ico" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>对象已死吗</title>
  
  
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/">LittleY&#39;Blog</a>
  <a class="face-img" href="/">
    <img src="https://avatars.githubusercontent.com/u/47181393?v=4">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    对象已死吗
  </h1>
  


    <ul class="article-info">
      <li>
        发布
        <time datetime="2021-05-22T05:02:30.000Z" itemprop="datePublished">2021-05-22</time>
      </li>
      <li>
        
    更新 <time datetime="2021-05-22T07:02:03.431Z" itemprop="dateUpdated">2021-05-22</time>

      </li>
      <li id="busuanzi_container_page_pv">
        阅读 <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        
        <h2 id="对象已死吗？"><a href="#对象已死吗？" class="headerlink" title="对象已死吗？"></a>对象已死吗？</h2><p>Java Heap中存放着几乎所有的对象实例，垃圾回收前，最重要的事就是判断是对象是否存活（还在被引用的对象）。</p>
<h3 id="1-引用计数法"><a href="#1-引用计数法" class="headerlink" title="1. 引用计数法"></a>1. 引用计数法</h3><p>给对象添加一个引用计数器,每一个地方引用它,计数器值就加1，对象引用失效的时候,计数器就减1.计数器值为0的时候,此对象为垃圾。</p>
<p><strong>优点</strong>：判定效率高</p>
<p><strong>缺点</strong>:如果对象间循环依赖,此算法无法正确判断是否为垃圾对象。因此主流虚拟机都没有用这种算法。</p>
<p><strong>循环依赖</strong>如下图所示：</p>
<img src="https://gitee.com/littley98/My_Images/raw/master/Spring_Theory/image-20200718161104467.png" alt="image-20200718161104467" style="zoom:67%;" />

<h3 id="2-可达性分析算法"><a href="#2-可达性分析算法" class="headerlink" title="2. 可达性分析算法"></a>2. 可达性分析算法</h3><p>目前主流的JVM都是用的可达性分析算法来判断对象是否存货的。</p>
<h4 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h4><p><code>GC Roots</code>的对象作为起始点从这些节点开始向下搜索,搜索所走过的路径称为引用链(Reference Chain)当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可达的。如下图：</p>
<img src="https://gitee.com/littley98/My_Images/raw/master/Spring_Theory/image-20200718161711008.png" alt="image-20200718161711008" style="zoom:67%;" />

<p>图中黄色的对象仍然存活，灰色的显然是不可达的，即为可回收的对象。</p>
<h4 id="可作为GC-Root对象的包括"><a href="#可作为GC-Root对象的包括" class="headerlink" title="可作为GC Root对象的包括"></a>可作为GC Root对象的包括</h4><ol>
<li>栈帧中本地变量表中引用的对象</li>
<li>方法区类静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>方法栈JNI引用的对象</li>
</ol>
<h4 id="关于引用（强软弱虚）"><a href="#关于引用（强软弱虚）" class="headerlink" title="关于引用（强软弱虚）"></a>关于引用（强软弱虚）</h4><p><strong>强引用</strong>：类似于<code>Object obj = new Object()</code>这种的就属于强引用，只要强引用存在，就永远不会被回收。</p>
<p><strong>软引用</strong>：有用，但是非必须的对象。对于这些软引用关联的对象，在要发生内存异常前，将会把他们列到回收范围中进行GC，如果内存依然不够，才会报内存溢出异常。</p>
<p><strong>弱引用</strong>：非必须对象，被若引用关联的对象只能生存到下一次GC发生之前。当开始GC时，无论内存是否够用，都会回收。</p>
<p><strong>虚引用</strong>：最弱的一种引用关系，一个对象是否有虚引用，完全不影响其生存时间，，也无法通过虚引用来取得一个对象实例。为对象设置虚引用的唯一目的就是能在这个对象被回收时，收到一个系统通知。</p>
<h3 id="3-不可达对象是否死亡判断"><a href="#3-不可达对象是否死亡判断" class="headerlink" title="3. 不可达对象是否死亡判断"></a>3. 不可达对象是否死亡判断</h3><p>当对象不可达GC Roots时，将会对其进行第一次筛选，如果其未覆盖<code>finalize()</code>方法或者已经调用过一次<code>finalize()</code>方法的话，讲直接将其回收。否则，将会给其一个逃脱死亡命运的机会，并对其标记。如果到第二次GC时，它还没有被引用的话，那将会被直接回收。</p>
<h3 id="4-Method-Area的回收"><a href="#4-Method-Area的回收" class="headerlink" title="4. Method Area的回收"></a>4. Method Area的回收</h3><p>此区域的垃圾回收效率较低。</p>
<p>一般回收两部分内容，即：<strong>废弃常量</strong>和<strong>无用的类</strong>。</p>
<p><strong>废弃常量</strong>：如果无任何地方引用此常量，那么它讲在下一次GC时被回收。</p>
<p><strong>无用的类</strong>：需要同时达到以下三个条件:</p>
<ol>
<li>该类所有实例都被回收</li>
<li>加载该类的ClassLoader被回收</li>
<li>该类对应的class对象没有被引用,无法在任何地方反射访问该类方法</li>
</ol>

      </div>
        <div class="support-author">
          <p>感谢您的阅读。 🙏
          <a href="" target="_blank">关于转载请看这里</a>
            <!--<a class="btn-pay"  href="#pay-modal">¥ 打赏支持</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>喜欢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          

        </div>
      </div>
    </div>
   </div>
</main>
<div class="footer">
  <div class="info">
    <p>
    <a target="_blank" rel="noopener" href="https://hexo.io"> Hexo </a> 强力驱动 |
      <a target="_blank" rel="noopener" href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      主题
    </p>
    <p>&copy;2020-2021 LittleY的博客</p>
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>//console
  var consoleConfig = '\n欢迎访问 https://littley98.github.io/ ，围观LittleY的博客(づ｡◕‿‿◕｡)づ！\n'.split(',');
  var canConsole = true;
  var consoleInfo = (function(consoleConfig) {
  if (!canConsole || !consoleConfig || consoleConfig.length < 1) {
    return;
  }
  var consoleColor = '#6190e8';
  var _console;
  var backgroundTextStyle = 'padding: 1px 5px;color: #fff;background: ' + consoleColor + ';'
  var textStyle = 'color: ' + consoleColor + ';';

  consoleConfig.map(o => {
    var num = (o.match(/%c/g) || []).length;
    if(/^http(s)?:\/\//.test(o)) {
      console.log('%c     ', 'background: url(' + o + ') no-repeat left center;font-size: 180px;');
      return;
    }
    if (num > 0) {
      var logArguments = [];
      for (var i = 0; i < num; i++) {
        if (i % 2 === 0) {
          logArguments.push(backgroundTextStyle);
        } else {
          logArguments.push(textStyle);
        }
      }
      (_console = console).log.apply(_console, ['%c' + o, textStyle].concat(logArguments));
      return;
    }
    console.log('%c' + o, textStyle);
  });
}(consoleConfig));</script><script type="text/javascript" src="/./js/main.js"></script>

  <script src="//at.alicdn.com/t/font_159214_mvtxvg9me9.js"></script>
</body>
</html>
